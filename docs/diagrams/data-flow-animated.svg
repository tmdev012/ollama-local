<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <defs>
    <filter id="glow-blue">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feFlood flood-color="#1976d2" flood-opacity="0.7"/>
      <feComposite in2="coloredBlur" operator="in"/>
      <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glow-orange">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feFlood flood-color="#f57c00" flood-opacity="0.7"/>
      <feComposite in2="coloredBlur" operator="in"/>
      <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glow-pink">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feFlood flood-color="#c2185b" flood-opacity="0.7"/>
      <feComposite in2="coloredBlur" operator="in"/>
      <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glow-purple">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feFlood flood-color="#7b1fa2" flood-opacity="0.7"/>
      <feComposite in2="coloredBlur" operator="in"/>
      <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glow-green">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feFlood flood-color="#388e3c" flood-opacity="0.7"/>
      <feComposite in2="coloredBlur" operator="in"/>
      <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">Data Flow - Query Lifecycle</text>

  <!-- Participants -->
  <g id="user-box">
    <rect x="50" y="50" width="80" height="40" rx="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="2">
      <animate id="user-glow" attributeName="filter" values=";url(#glow-blue);" dur="0.3s" begin="0s;loop.end" fill="freeze"/>
    </rect>
    <text x="90" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565c0">User</text>
  </g>

  <rect x="200" y="50" width="80" height="40" rx="5" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
  <text x="240" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e65100">SASHI</text>

  <rect x="350" y="50" width="80" height="40" rx="5" fill="#fce4ec" stroke="#c2185b" stroke-width="2"/>
  <text x="390" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#880e4f">Router</text>

  <rect x="500" y="50" width="80" height="40" rx="5" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="540" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#6a1b9a">MCP</text>

  <rect x="650" y="50" width="80" height="40" rx="5" fill="#e8f5e9" stroke="#388e3c" stroke-width="2"/>
  <text x="690" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2e7d32">SQLite</text>

  <!-- Lifelines -->
  <line x1="90" y1="90" x2="90" y2="380" stroke="#1976d2" stroke-width="1" stroke-dasharray="4,4" opacity="0.5"/>
  <line x1="240" y1="90" x2="240" y2="380" stroke="#f57c00" stroke-width="1" stroke-dasharray="4,4" opacity="0.5"/>
  <line x1="390" y1="90" x2="390" y2="380" stroke="#c2185b" stroke-width="1" stroke-dasharray="4,4" opacity="0.5"/>
  <line x1="540" y1="90" x2="540" y2="380" stroke="#7b1fa2" stroke-width="1" stroke-dasharray="4,4" opacity="0.5"/>
  <line x1="690" y1="90" x2="690" y2="380" stroke="#388e3c" stroke-width="1" stroke-dasharray="4,4" opacity="0.5"/>

  <!-- Step 1: User to SASHI -->
  <g opacity="0">
    <animate id="s1" attributeName="opacity" values="0;1" dur="0.1s" begin="user-glow.begin+0.2s" fill="freeze"/>
    <line x1="90" y1="120" x2="228" y2="120" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)"/>
    <rect x="110" y="105" width="100" height="20" rx="3" fill="#e3f2fd" stroke="#1976d2">
      <animate attributeName="filter" values=";url(#glow-blue);" dur="0.2s" begin="s1.begin" fill="freeze"/>
    </rect>
    <text x="160" y="118" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">sask "question"</text>
  </g>
  <!-- Moving dot 1 -->
  <circle r="6" fill="#1976d2" opacity="0">
    <animate attributeName="opacity" values="0;1;1;0" dur="0.4s" begin="s1.begin" fill="freeze"/>
    <animate attributeName="cx" values="90;230" dur="0.3s" begin="s1.begin" fill="freeze"/>
    <animate attributeName="cy" values="120;120" dur="0.3s" begin="s1.begin" fill="freeze"/>
  </circle>

  <!-- Step 2: SASHI to Router -->
  <g opacity="0">
    <animate id="s2" attributeName="opacity" values="0;1" dur="0.1s" begin="s1.begin+0.4s" fill="freeze"/>
    <line x1="240" y1="160" x2="378" y2="160" stroke="#f57c00" stroke-width="2" marker-end="url(#arrow)"/>
    <rect x="260" y="145" width="100" height="20" rx="3" fill="#fff3e0" stroke="#f57c00">
      <animate attributeName="filter" values=";url(#glow-orange);" dur="0.2s" begin="s2.begin" fill="freeze"/>
    </rect>
    <text x="310" y="158" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">Parse command</text>
  </g>
  <circle r="6" fill="#f57c00" opacity="0">
    <animate attributeName="opacity" values="0;1;1;0" dur="0.4s" begin="s2.begin" fill="freeze"/>
    <animate attributeName="cx" values="240;380" dur="0.3s" begin="s2.begin" fill="freeze"/>
    <animate attributeName="cy" values="160;160" dur="0.3s" begin="s2.begin" fill="freeze"/>
  </circle>

  <!-- Step 3: Router self-loop -->
  <g opacity="0">
    <animate id="s3" attributeName="opacity" values="0;1" dur="0.1s" begin="s2.begin+0.4s" fill="freeze"/>
    <path d="M 400 195 C 450 195 450 220 400 220" stroke="#c2185b" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    <rect x="410" y="192" width="90" height="20" rx="3" fill="#fce4ec" stroke="#c2185b">
      <animate attributeName="filter" values=";url(#glow-pink);" dur="0.3s" begin="s3.begin" fill="freeze"/>
    </rect>
    <text x="455" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#880e4f">→ DeepSeek</text>
  </g>

  <!-- Step 4: Router to MCP -->
  <g opacity="0">
    <animate id="s4" attributeName="opacity" values="0;1" dur="0.1s" begin="s3.begin+0.4s" fill="freeze"/>
    <line x1="390" y1="250" x2="528" y2="250" stroke="#7b1fa2" stroke-width="2" marker-end="url(#arrow)"/>
    <rect x="410" y="235" width="100" height="20" rx="3" fill="#f3e5f5" stroke="#7b1fa2">
      <animate attributeName="filter" values=";url(#glow-purple);" dur="0.2s" begin="s4.begin" fill="freeze"/>
    </rect>
    <text x="460" y="248" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6a1b9a">Forward prompt</text>
  </g>
  <circle r="6" fill="#7b1fa2" opacity="0">
    <animate attributeName="opacity" values="0;1;1;0" dur="0.4s" begin="s4.begin" fill="freeze"/>
    <animate attributeName="cx" values="390;530" dur="0.3s" begin="s4.begin" fill="freeze"/>
    <animate attributeName="cy" values="250;250" dur="0.3s" begin="s4.begin" fill="freeze"/>
  </circle>

  <!-- Step 5: MCP API call (self-loop) -->
  <g opacity="0">
    <animate id="s5" attributeName="opacity" values="0;1" dur="0.1s" begin="s4.begin+0.4s" fill="freeze"/>
    <path d="M 550 275 C 600 275 600 300 550 300" stroke="#7b1fa2" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    <rect x="555" y="272" width="60" height="20" rx="3" fill="#f3e5f5" stroke="#7b1fa2">
      <animate attributeName="filter" values=";url(#glow-purple);url(#glow-purple);url(#glow-purple);" dur="0.8s" begin="s5.begin" fill="freeze"/>
    </rect>
    <text x="585" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6a1b9a">API...</text>
  </g>
  <!-- Processing dots -->
  <g opacity="0">
    <animate attributeName="opacity" values="0;1;0" dur="0.8s" begin="s5.begin" fill="freeze"/>
    <circle cx="600" cy="310" r="3" fill="#7b1fa2">
      <animate attributeName="opacity" values="0.3;1;0.3" dur="0.3s" repeatCount="3" begin="s5.begin"/>
    </circle>
    <circle cx="610" cy="310" r="3" fill="#7b1fa2">
      <animate attributeName="opacity" values="0.3;1;0.3" dur="0.3s" repeatCount="3" begin="s5.begin+0.1s"/>
    </circle>
    <circle cx="620" cy="310" r="3" fill="#7b1fa2">
      <animate attributeName="opacity" values="0.3;1;0.3" dur="0.3s" repeatCount="3" begin="s5.begin+0.2s"/>
    </circle>
  </g>

  <!-- Step 6: MCP response back to Router -->
  <g opacity="0">
    <animate id="s6" attributeName="opacity" values="0;1" dur="0.1s" begin="s5.begin+0.9s" fill="freeze"/>
    <line x1="528" y1="320" x2="402" y2="320" stroke="#388e3c" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrow)"/>
    <rect x="430" y="305" width="80" height="20" rx="3" fill="#c8e6c9" stroke="#388e3c">
      <animate attributeName="filter" values=";url(#glow-green);" dur="0.2s" begin="s6.begin" fill="freeze"/>
    </rect>
    <text x="470" y="318" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">Response</text>
  </g>
  <circle r="6" fill="#388e3c" opacity="0">
    <animate attributeName="opacity" values="0;1;1;0" dur="0.4s" begin="s6.begin" fill="freeze"/>
    <animate attributeName="cx" values="530;400" dur="0.3s" begin="s6.begin" fill="freeze"/>
    <animate attributeName="cy" values="320;320" dur="0.3s" begin="s6.begin" fill="freeze"/>
  </circle>

  <!-- Step 7: Async log to SQLite -->
  <g opacity="0">
    <animate id="s7" attributeName="opacity" values="0;1" dur="0.1s" begin="s6.begin+0.3s" fill="freeze"/>
    <line x1="402" y1="340" x2="678" y2="340" stroke="#ffa000" stroke-width="1.5" stroke-dasharray="4,4" marker-end="url(#arrow)"/>
    <rect x="490" y="325" width="80" height="20" rx="3" fill="#fff8e1" stroke="#ffa000"/>
    <text x="530" y="338" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#ff8f00">Log async</text>
  </g>

  <!-- Step 8: Router to SASHI -->
  <g opacity="0">
    <animate id="s8" attributeName="opacity" values="0;1" dur="0.1s" begin="s6.begin+0.4s" fill="freeze"/>
    <line x1="378" y1="355" x2="252" y2="355" stroke="#f57c00" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrow)"/>
    <rect x="280" y="340" width="80" height="20" rx="3" fill="#fff3e0" stroke="#f57c00">
      <animate attributeName="filter" values=";url(#glow-orange);" dur="0.2s" begin="s8.begin" fill="freeze"/>
    </rect>
    <text x="320" y="353" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">Format</text>
  </g>
  <circle r="6" fill="#f57c00" opacity="0">
    <animate attributeName="opacity" values="0;1;1;0" dur="0.4s" begin="s8.begin" fill="freeze"/>
    <animate attributeName="cx" values="380;250" dur="0.3s" begin="s8.begin" fill="freeze"/>
    <animate attributeName="cy" values="355;355" dur="0.3s" begin="s8.begin" fill="freeze"/>
  </circle>

  <!-- Step 9: SASHI to User -->
  <g opacity="0">
    <animate id="s9" attributeName="opacity" values="0;1" dur="0.1s" begin="s8.begin+0.4s" fill="freeze"/>
    <line x1="228" y1="370" x2="102" y2="370" stroke="#1976d2" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrow)"/>
    <rect x="130" y="355" width="80" height="20" rx="3" fill="#c8e6c9" stroke="#388e3c">
      <animate attributeName="filter" values=";url(#glow-green);" dur="0.3s" begin="s9.begin" fill="freeze"/>
    </rect>
    <text x="170" y="368" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">Display ✓</text>
  </g>
  <circle r="6" fill="#4caf50" opacity="0">
    <animate attributeName="opacity" values="0;1;1;0" dur="0.4s" begin="s9.begin" fill="freeze"/>
    <animate attributeName="cx" values="230;100" dur="0.3s" begin="s9.begin" fill="freeze"/>
    <animate attributeName="cy" values="370;370" dur="0.3s" begin="s9.begin" fill="freeze"/>
  </circle>

  <!-- Success indicator -->
  <g opacity="0">
    <animate id="loop" attributeName="opacity" values="0;1;1;0" dur="1s" begin="s9.begin+0.5s" fill="freeze"/>
    <circle cx="90" cy="370" r="12" fill="#4caf50"/>
    <path d="M 84 370 L 88 374 L 96 366" stroke="#fff" stroke-width="2" fill="none"/>
  </g>

  <!-- Step numbers -->
  <circle cx="160" cy="120" r="10" fill="#1976d2" opacity="0.9"/><text x="160" y="124" text-anchor="middle" font-family="Arial" font-size="9" fill="#fff">1</text>
  <circle cx="310" cy="160" r="10" fill="#f57c00" opacity="0.9"/><text x="310" y="164" text-anchor="middle" font-family="Arial" font-size="9" fill="#fff">2</text>
  <circle cx="455" cy="207" r="10" fill="#c2185b" opacity="0.9"/><text x="455" y="211" text-anchor="middle" font-family="Arial" font-size="9" fill="#fff">3</text>
  <circle cx="460" cy="250" r="10" fill="#7b1fa2" opacity="0.9"/><text x="460" y="254" text-anchor="middle" font-family="Arial" font-size="9" fill="#fff">4</text>
  <circle cx="585" cy="287" r="10" fill="#7b1fa2" opacity="0.9"/><text x="585" y="291" text-anchor="middle" font-family="Arial" font-size="9" fill="#fff">5</text>
  <circle cx="470" cy="320" r="10" fill="#388e3c" opacity="0.9"/><text x="470" y="324" text-anchor="middle" font-family="Arial" font-size="9" fill="#fff">6</text>
  <circle cx="530" cy="340" r="10" fill="#ffa000" opacity="0.9"/><text x="530" y="344" text-anchor="middle" font-family="Arial" font-size="9" fill="#fff">7</text>
  <circle cx="320" cy="355" r="10" fill="#f57c00" opacity="0.9"/><text x="320" y="359" text-anchor="middle" font-family="Arial" font-size="9" fill="#fff">8</text>
  <circle cx="170" cy="370" r="10" fill="#4caf50" opacity="0.9"/><text x="170" y="374" text-anchor="middle" font-family="Arial" font-size="9" fill="#fff">9</text>

  <!-- Timer -->
  <g transform="translate(760, 380)">
    <circle r="12" fill="none" stroke="#ddd" stroke-width="2"/>
    <circle r="12" fill="none" stroke="#4caf50" stroke-width="2" stroke-dasharray="75" stroke-dashoffset="75" transform="rotate(-90)">
      <animate attributeName="stroke-dashoffset" values="75;0" dur="5s" begin="0s;loop.end" fill="freeze"/>
    </circle>
    <text x="0" y="4" text-anchor="middle" font-family="Arial" font-size="8" fill="#666">5s</text>
  </g>
</svg>
